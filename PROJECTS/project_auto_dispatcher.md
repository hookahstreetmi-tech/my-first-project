# PROJECT: AUTO-DISPATCHER (H-009)

# The "Smart Ear" Architecture (SIP + Whisper + Calendar)

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ù–∞—à –ø—Ä–æ–¥—É–∫—Ç ‚Äî —ç—Ç–æ **"AI-–°–µ–∫—Ä–µ—Ç–∞—Ä—å"** –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏ –∏ —á–∞—Å—Ç–Ω—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤.
–ú—ã –Ω–µ –∑–∞—Å—Ç–∞–≤–ª—è–µ–º –∏—Ö –º–µ–Ω—è—Ç—å –ø—Ä–∏–≤—ã—á–∫–∏. –û–Ω–∏ —Ç–∞–∫ –∂–µ –≥–æ–≤–æ—Ä—è—Ç –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.
–ú—ã –¥–æ–±–∞–≤–ª—è–µ–º –º–∞–≥–∏—é: –∫–∞–∂–¥—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Å–æ–±—ã—Ç–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ –∏ –∫–∞—Ä—Ç–æ—á–∫—É –∑–∞–∫–∞–∑–∞ –≤ Telegram.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Multi-Tenant)

### 1. Ingestion Layer (–í—Ö–æ–¥ / –¢–µ–ª–µ—Ñ–æ–Ω–∏—è)

- **Provider**: Zadarma / Novofon.
- **Setup**:
  1.  –ú—ã –ø–æ–∫—É–ø–∞–µ–º –ø—É–ª –Ω–æ–º–µ—Ä–æ–≤ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö).
  2.  –í—ã–¥–∞–µ–º –∫–∞–∂–¥–æ–º—É –≤–æ–¥–∏—Ç–µ–ª—é **–ª–∏—á–Ω—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä**.
  3.  –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ê–¢–° —Å—Ç–∞–≤–∏–º **Webhook** –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `NOTIFY_END` (–∫–æ–Ω–µ—Ü –∑–≤–æ–Ω–∫–∞).
  4.  –ê–¢–° —à–ª–µ—Ç –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä —Å—Å—ã–ª–∫—É –Ω–∞ MP3 –∑–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ + `CalledID` (–Ω–æ–º–µ—Ä –≤–æ–¥–∏—Ç–µ–ª—è) + `CallerID` (–∫–ª–∏–µ–Ω—Ç).

### 2. Processing Layer (–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç / n8n)

- **Workflow**: –ï–¥–∏–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
  1.  **Webhook Trigger**: –ü–æ–ª—É—á–∞–µ—Ç `mp3_url`, `driver_phone`.
  2.  **Lookup User**: –ò—â–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è –≤ –±–∞–∑–µ Supabase –ø–æ `driver_phone`.
      - –ü–æ–ª—É—á–∞–µ—Ç `telegram_chat_id` –∏ `google_calendar_token`.
  3.  **Transcribe (Whisper)**: MP3 -> –¢–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞.
  4.  **Analyze (GPT-4o)**:
      - System Prompt: "–¢—ã –¥–∏—Å–ø–µ—Ç—á–µ—Ä. –ò–∑–≤–ª–µ–∫–∏ JSON: {service_type, date, time, address, price, client_name}".
      - –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Ç –∞–¥—Ä–µ—Å–∞), —Å—Ç–∞–≤–∏—Ç —Ñ–ª–∞–≥ `incomplete: true`.

### 3. Action Layer (–î–µ–π—Å—Ç–≤–∏–µ)

- **Telegram Bot**: –®–ª–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—é (`chat_id`).
  - **–°—Ü–µ–Ω–∞—Ä–∏–π A (–£—Å–ø–µ—Ö)**:
    - "‚úÖ **–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!**\nüìÖ –ó–∞–≤—Ç—Ä–∞ 14:00\nüìç –õ–µ–Ω–∏–Ω–∞ 5\nüí∞ 5000—Ä\nüë§ –ö–ª–∏–µ–Ω—Ç: 8900..."
    - **Auto-Calendar**: –°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
  - **–°—Ü–µ–Ω–∞—Ä–∏–π B (–ù–µ–ø–æ–ª–Ω–æ)**:
    - "‚ö†Ô∏è **–£—Ç–æ—á–Ω–∏—Ç–µ –∑–∞–∫–∞–∑**\n–ö–ª–∏–µ–Ω—Ç –ø—Ä–æ—Å–∏–ª –Ω–∞ –∑–∞–≤—Ç—Ä–∞, –Ω–æ –Ω–µ —Å–∫–∞–∑–∞–ª –∞–¥—Ä–µ—Å.\n[–ö–Ω–æ–ø–∫–∞: –í–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å –≥–æ–ª–æ—Å–æ–º]".

### 4. Database Schema (Supabase)

- `users`: phone (PK), telegram_id, name, subscription_status.
- `integrations`: user_id (FK), service ('google', 'zadarma'), access_token, refresh_token.
- `calls`: id, user_id, recording_url, transcript, extracted_data_json, created_at.

---

## üí∞ Unit Economics (–≠–∫–æ–Ω–æ–º–∏–∫–∞ 1 –≤–æ–¥–∏—Ç–µ–ª—è)

- **–†–∞—Å—Ö–æ–¥—ã**:
  - –ù–æ–º–µ—Ä (SIP): 200—Ä/–º–µ—Å.
  - Whisper (100 –∑–≤–æ–Ω–∫–æ–≤ \* 2 –º–∏–Ω): ~$1.2 (120—Ä).
  - GPT (100 –∑–≤–æ–Ω–∫–æ–≤): ~$0.5 (50—Ä).
  - –°–µ—Ä–≤–µ—Ä (–¥–æ–ª—è): 50—Ä.
  - **–ò—Ç–æ–≥–æ COGS**: ~420 —Ä—É–±/–º–µ—Å.
- **–¶–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏**: 2500 —Ä—É–±/–º–µ—Å.
- **–ú–∞—Ä–∂–∞**: ~2000 —Ä—É–±/–º–µ—Å (83%).
- **LTV**: –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ (–ø–æ–∫–∞ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–º).

## üöÄ –ü–ª–∞–Ω –ó–∞–ø—É—Å–∫–∞ (Go-To-Market)

1.  **MVP (Day 1)**:
    - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å 1 –Ω–æ–º–µ—Ä Zadarma + n8n + Telegram.
    - –ü—Ä–∏–Ω—è—Ç—å 1 –∑–≤–æ–Ω–æ–∫ –∏ —É–≤–∏–¥–µ—Ç—å –∑–∞–ø–∏—Å—å –≤ Google Calendar.
2.  **Beta (Week 1)**:
    - –î–∞—Ç—å 2-–º –∑–Ω–∞–∫–æ–º—ã–º –≤–æ–¥–∏—Ç–µ–ª—è–º (–±–µ—Å–ø–ª–∞—Ç–Ω–æ).
    - –°–æ–±—Ä–∞—Ç—å 50 –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –¥–æ–æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞.

---

_–î–æ–∫—É–º–µ–Ω—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞–ø—Ä—è–º—É—é._
