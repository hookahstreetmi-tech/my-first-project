# MVP Roadmap: AUTO-DISPATCHER (H-009)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —ç—Ç–∞–ø—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ MVP –≤–µ—Ä—Å–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞.

---

## üìÖ –ì—Ä–∞—Ñ–∏–∫ –∑–∞–ø—É—Å–∫–∞ (–§–µ–≤—Ä–∞–ª—å 2026)

### –≠—Ç–∞–ø 1: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç (–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è)

**–°—Ä–æ–∫**: 5 –§–µ–≤—Ä–∞–ª—è (–°–µ–≥–æ–¥–Ω—è)
**–£—á–∞—Å—Ç–Ω–∏–∫–∏**: –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ + AI-–∞–≥–µ–Ω—Ç.
**–ó–∞–¥–∞—á–∏**:

- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ "–≥—Ä—è–∑–Ω–æ–≥–æ" –≥–æ–ª–æ—Å–∞ (—à—É–º, –¥–∏–∫—Ü–∏—è).
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Ç–æ–ø–æ–Ω–∏–º–æ–≤ (–°–ù–¢, –Ω–æ–≤—ã–µ –ñ–ö, –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —É–ª–∏—Ü).
- [x] –û—Ç–ª–∞–¥–∫–∞ —Ü–µ–ø–æ—á–∫–∏: Voice -> Whisper -> LLM -> Confirmation Card -> Google Calendar -> Telegram Link.
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–∫–∏ –æ—Ç–º–µ–Ω—ã (`callback_query` "no").
- [x] **New**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ ("–ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...") –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ UX.

### –≠—Ç–∞–ø 2: –ó–∞–∫—Ä—ã—Ç–∞—è –ê–ª—å—Ñ–∞ (Whitelist)

**–°—Ä–æ–∫**: 6‚Äì7 –§–µ–≤—Ä–∞–ª—è
**–£—á–∞—Å—Ç–Ω–∏–∫–∏**: 2‚Äì3 –ª–æ—è–ª—å–Ω—ã—Ö –≤–æ–¥–∏—Ç–µ–ª—è.
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏**:

- [ ] –í–Ω–µ–¥—Ä–µ–Ω–∏–µ **Whitelist**: –ø—Ä–æ–≤–µ—Ä–∫–∞ `chat_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã.
- [ ] –°–±–æ—Ä –ª–æ–≥–æ–≤ –æ—à–∏–±–æ–∫ (failed extractions).
- [ ] –§–∏–∫—Å "–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π" –ò–ò –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.

### –≠—Ç–∞–ø 3: –ü—É–±–ª–∏—á–Ω—ã–π MVP –ü–∏–ª–æ—Ç (–í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–∏)

**–°—Ä–æ–∫**: –° 9 –§–µ–≤—Ä–∞–ª—è (–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
**–£—á–∞—Å—Ç–Ω–∏–∫–∏**: 10+ –≤–æ–¥–∏—Ç–µ–ª–µ–π.
**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞**:

- **Retention**: –í–æ–¥–∏—Ç–µ–ª—å –ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º –±–æ–ª–µ–µ 3-—Ö —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.
- **Accuracy**: –û—à–∏–±–∫–∏ –≤ –∞–¥—Ä–µ—Å–∞—Ö –∏–ª–∏ —Ü–µ–Ω–µ < 5%.
- **Speed**: –í—Ä–µ–º—è –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ –¥–æ –≤—ã–¥–∞—á–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ < 7 —Å–µ–∫—É–Ω–¥.

---

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ß–µ–∫-–ª–∏—Å—Ç MVP

1. **Safety First**:
   - [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ (Whitelist).
   - [ ] –õ–∏–º–∏—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞/–æ—à–∏–±–æ–∫).

2. **UX / UI**:
   - [x] –°—Ç–∞—Ç—É—Å "typing..." –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã Whisper/LLM (–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫).
   - [x] –ü–æ–Ω—è—Ç–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –æ—à–∏–±–æ–∫ ("–ù–µ —Ä–∞–∑–æ–±—Ä–∞–ª –∞–¥—Ä–µ—Å", "–£—Ç–æ—á–Ω–∏ –≤—Ä–µ–º—è").
   - [x] –†–∞–±–æ—á–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ –≤ –∏—Ç–æ–≥–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.

3. **Analytics (Log Layer)**:
   - [ ] –ó–∞–ø–∏—Å—å –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Google Sheets: `Driver ID`, `Raw Text`, `Extracted JSON`, `Status` (Confirmed/Cancelled).

---

## üöÄ –ß—Ç–æ —Å—á–∏—Ç–∞–µ–º –ì–æ—Ç–æ–≤—ã–º MVP?

–ü—Ä–æ–¥—É–∫—Ç –≥–æ—Ç–æ–≤, –µ—Å–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–¥–∏–∫—Ç–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Ö–æ–¥—É, –Ω–∞–∂–∞—Ç—å –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –ø–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç –ö–∞–ª–µ–Ω–¥–∞—Ä—è Google, –Ω–µ –∑–∞—Ö–æ–¥—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –≤—Ä—É—á–Ω—É—é.

_–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: 05.02.2026_
# TECHNICAL DESIGN: Auto-Dispatcher Stabilization (Phase 2)

## 1. Database Optimization (Supabase)

–ü–µ—Ä–µ—Ö–æ–¥ —Å Google Sheets –Ω–∞ Supabase –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (SSOT).

- **Table `drivers`**: –•—Ä–∞–Ω–∏—Ç –ø—Ä–æ—Ñ–∏–ª–∏, —Ç–∞—Ä–∏—Ñ—ã –∏ `calendar_id`.
- **Table `orders`**: –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –≤ –õ–∏—á–Ω–æ–º –ö–∞–±–∏–Ω–µ—Ç–µ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–∏–±—ã–ª–∏ –∏ —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤.

## 2. Authorization Flow Improvements

–¢–µ–∫—É—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ Google Sheets –º–µ–¥–ª–µ–Ω–Ω–∞—è –∏ —Ç—Ä—É–¥–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è.

- **Auth by TG ID**: n8n –¥–µ–ª–∞–µ—Ç –±—ã—Å—Ç—Ä—ã–π SELECT –∫ Supabase –ø–æ `msg.from.id`.
- **Dynamic Context**: –í–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤, –º—ã –±—É–¥–µ–º –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å `settings` –≤–æ–¥–∏—Ç–µ–ª—è –ø—Ä—è–º–æ –∏–∑ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∫–æ–π —Ç–∏–ø —É—Å–ª—É–≥–∏ —É –Ω–µ–≥–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

## 3. Updated User Journey (–ü—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

### Scenario A: –ù–æ–≤–∏—á–æ–∫ (–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥)

1.  –ü–∏—à–µ—Ç –±–æ—Ç—É `/start`.
2.  –ë–æ—Ç –≤–∏–¥–∏—Ç, —á—Ç–æ `telegram_id` –Ω–µ—Ç –≤ `drivers`.
3.  –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤: "–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?", "–í–∞—à Google Email –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è?".
4.  –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `trial`.

### Scenario B: –†–∞–±–æ—Ç–∞—é—â–∏–π –≤–æ–¥–∏—Ç–µ–ª—å

1.  –®–ª–µ—Ç –≥–æ–ª–æ—Å/—Ç–µ–∫—Å—Ç.
2.  –ë–æ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–∑–Ω–∞–µ—Ç –µ–≥–æ, –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç `calendar_id`.
3.  –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ AI -> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.

### Scenario C: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–æ–º (–ë—É–¥—É—â–µ–µ)

1.  –ö–æ–º–∞–Ω–¥–∞ `/cabinet` –≤—ã–¥–∞–µ—Ç –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞/—Ç–∞—Ä–∏—Ñ–∞ (–¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase).

## 4. n8n Implementation Tasks (TODO)

- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –Ω–æ–¥—É `Lookup Whitelist` –Ω–∞ Supabase Node.
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É `Insert Order` –≤ –∫–æ–Ω—Ü–µ –≤–æ—Ä–∫—Ñ–ª–æ—É `MAIN 2 AUTO`.
- [ ] –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `/start` –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

---

_–°—ç—Ä, –µ—Å–ª–∏ —ç—Ç–æ—Ç –ø–ª–∞–Ω ¬´–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏¬ª –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç, —è –Ω–∞—á–Ω—É –≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ—Ä–∫—Ñ–ª–æ—É._
