# Правила проекта: Кодекс Агента

## 1. Безопасность и Целостность

- **Никаких бэкапов**: НИКОГДА не восстанавливать предыдущие версии без явного подтверждения.
- **Чистый Git**: НИКОГДА не коммитить учетные данные (`.env`, `config.json`). Всегда проверять `git status`.
- **Запрет на удаление**: ВСЕГДА спрашивать перед удалением любого файла.
- **Лимит кода**: Максимальный объем файла — **700 строк**. При превышении — обязательный рефакторинг и разделение на модули.

## 2. Стандарты Коммуникации

- **Язык**: 100% общения, документации и описания задач — только на **русском языке**.
- **Оформление**: Использовать **эмодзи** в заголовках описаний изменений (коммиты/отчеты).

## 3. Протокол Изменений и Исполнения (Universal Approve)

ПЕРЕД нажатием кнопки "Approve" (для Shell или n8n-mcp) Агент ОБЯЗАН:

1. Кратко объяснить в чате: **ЧТО** будет сделано и **ЗАЧЕМ**.
2. В случае отсутствия кнопки запустить `./scripts/approve.sh`.
3. **Разграничение n8n**: Агент — логика и архитектура, Пользователь — учетные данные (Credentials).
4. **Immutable Workflows**: ЗАПРЕЩЕНО изменять рабочие воркфлоу без согласования. Использовать `update_partial` только для одобренных правок.
5. **Разрешения n8n-mcp**:
   - `allow`: search, get, list, validate (автоматически).
   - `ask`: create, update, execute (через подтверждение).
   - `deny`: delete (полный запрет).

## 4. Управление Контекстом (Snapshots)

Каждые **40 сообщений** Агент обязан создать выжимку в `AI_CONTEXT/`:

- **Persona**: Текущая роль и стиль.
- **Key Facts**: Стек и глоссарий.
- **Progress**: Что сделано и где остановились.
- **Constraints**: Критические запреты.

## 5. Протоколы Проактивного Инжиниринга (АНТИ-ХАОС)

Агент действует как системный архитектор:

1. **Анализ Влияния (Impact Analysis)**: Запрещено менять одну ноду в изоляции. Проверять всю цепь: AI -> Sheet -> Telegram -> Calendar.
2. **Верификация Реальности**: ЗАПРЕЩЕНО полагаться на память. Перед любым советом вызвать `n8n_get_workflow` для проверки имен полей и связей.
3. **Нулевые Прочерки (Zero Ghost Data)**: Любой `null`, прочерк или пустая строка в интерфейсе — это авария. Расследовать и исправлять немедленно.
4. **Контракт Данных (SSOT)**: Строгое соответствие `PROJECTS/AUTO_DISPATCHER/contract.md`. Регистр и названия полей должны быть синхронизированы везде.
5. **Симуляция Ошибок**: Перед ответом «готово» мысленно прогнать сценарии: отмена, пустые поля, голосовой ввод.
