# Техническое руководство по реализации ivanov.industries (Ecosystem Update v4.0)

Этот документ синхронизирован с текущим состоянием экосистемы (29.01.2026).

## 1. Архитектура Экосистемы (Ecosystem)

Система эволюционировала из линейной трубы в интеллектуальный хаб с централизованным управлением.

| Стадия | Агент / Модуль | ID n8n | Функция |
| :--- | :--- | :--- | :--- |
| **Stage 1** | **Topic Generator** | `QTYaCNJB6hChBlIA` | Авто-генерация стратегических тем. |
| **Stage 2** | **Research Team** | `ItU0fZMVllwFxFDQ` | Глубокий ресерч (Perplexity). Передает `topic_id`. |
| **Stage 3** | **Brain Center** | `ggcoBC7nujBUXwmB` | Стратегический анализ и генерация гипотез. |
| **Stage 4** | **Dispatcher & Prod** | `n14qDgi3nFiGn9Fm` | **Центральный хаб**: Обработка команд из Telegram. |
| **Stage 5** | **Telegram Receiver** | `CPtb6ru14iM2YGNUjBg_T` | Ручной ввод тем и управление агентами. |

### Магистраль Данных (Data Flow)
Ключевым связующим звеном является `topic_id` (UUID), который пробрасывается с момента создания темы до финальной публикации контента. Это обеспечивает целостность контекста для всех ИИ-агентов.

---

## 2. Логика Диспетчеризации (The Brain Loop)

Система управляется через **Inline-кнопки** в Telegram. Диспетчер в Stage 4 маршрутизирует команды:

1.  **cmd:study** -> Отправляет промежуточное меню «Изучить».
    *   `study:full` -> Генерация HTML-лонгрида для Gmail.
    *   `study:short` -> Короткая выжимка в Telegram.
    *   `study:extra` -> Запуск повторного Deep Research.
2.  **cmd:smm** -> Передача гипотезы SMM-агенту для создания постов.
3.  **cmd:biz** -> Передача гипотезы Бизнес-ассистенту для нарезки задач (Google Calendar).

---

## 3. Настройка Базы Данных (Supabase)

Схема дополнена для поддержки расширенной логики:
*   `topics`: Темы (id, parent_topic, subtopic, status).
*   `knowledge`: Факты (id, topic_id, text, sources).
*   `hypotheses`: Идеи (id, topic_id, statement, confidence).
*   `content`: Готовые материалы (id, hypothesis_id, html_body).
*   `tasks`: Задачи (id, hypothesis_id, title, due_date, status).

---

## 4. Стандарт качества контента

Любое исходящее сообщение или письмо должно соответствовать **Шкале Элегантности (Zero-G)**:
*   **Gmail**: Премиальный HTML, наличие Citations, четкая структура.
*   **Telegram**: Мгновенная реакция ("Сэр, я уже в процессе..."), лаконичность.

---

*Документ зафиксирован 29.01.2026. Архитектура признана стабильной и готовой к масштабированию.*
